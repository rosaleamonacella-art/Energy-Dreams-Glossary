<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Energy Dreams — A Collaborative Lexicon</title>
  <meta name="description" content="A collaborative glossary of critical terms, concepts, and frameworks for navigating the entangled landscapes of energy, extractive geographies, ecology, and the planetary crisis." />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,400&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #000; color: #fff; font-family: 'Open Sans', sans-serif; }
    ::selection { background: rgba(255,255,255,0.25); color: #fff; }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); }
    input::placeholder { color: rgba(255,255,255,0.18); }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes lineExpand { from { width: 0; } to { width: 100%; } }
    @keyframes pulse { 0%, 100% { opacity: 0.15; } 50% { opacity: 0.45; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo, useCallback } = React;

    // ╔══════════════════════════════════════════════════════════════════╗
    // ║  CONFIGURATION — UPDATE THESE TWO URLs                         ║
    // ╠══════════════════════════════════════════════════════════════════╣
    // ║                                                                ║
    // ║  1. Replace with your published Google Sheet CSV URL           ║
    // ║  2. Replace with your Google Form URL                          ║
    // ║                                                                ║
    // ╚══════════════════════════════════════════════════════════════════╝

    const GOOGLE_SHEET_CSV_URL = "YOUR_PUBLISHED_CSV_URL_HERE";
    const GOOGLE_FORM_URL = "YOUR_GOOGLE_FORM_URL_HERE";

    // ── CSV Parser ─────────────────────────────────────────────────────
    function parseCSVEntries(csvText) {
      const result = Papa.parse(csvText, {
        header: true,
        skipEmptyLines: true,
        transformHeader: (h) => h.trim(),
      });

      return result.data
        .filter(row => row["Term"] && row["Term"].trim() !== "")
        .map((row, i) => ({
          id: i + 1,
          term: (row["Term"] || "").trim(),
          definition: (row["Definition"] || "").trim(),
          tags: (row["Tags"] || "")
            .split(",")
            .map(t => t.trim().toLowerCase())
            .filter(t => t !== ""),
          crossRefs: (row["Cross-References"] || "")
            .split(",")
            .map(r => r.trim())
            .filter(r => r !== ""),
          citations: (row["Citations"] || "")
            .split(";")
            .map(c => c.trim())
            .filter(c => c !== ""),
          author: (row["Author"] || "").trim(),
          date: (row["Date"] || "").trim(),
          imageUrl: (row["Image URL"] || "").trim(),
          mediaUrl: (row["Media URL"] || "").trim(),
        }));
    }

    // ── Fetch entries from Google Sheet ─────────────────────────────────
    function useFetchEntries() {
      const [entries, setEntries] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        if (GOOGLE_SHEET_CSV_URL === "YOUR_PUBLISHED_CSV_URL_HERE") {
          setLoading(false);
          return;
        }

        fetch(GOOGLE_SHEET_CSV_URL)
          .then(res => {
            if (!res.ok) throw new Error("Failed to fetch sheet");
            return res.text();
          })
          .then(csv => {
            const parsed = parseCSVEntries(csv);
            setEntries(parsed);
            setLoading(false);
          })
          .catch(err => {
            console.error("Error loading glossary:", err);
            setError(err.message);
            setLoading(false);
          });
      }, []);

      return { entries, loading, error };
    }

    const ALL_TAGS_FROM = (entries) => [...new Set(entries.flatMap(e => e.tags))].sort();

    // ── Noise SVG ──────────────────────────────────────────────────────
    const NoiseSVG = () => (
      <svg style={{ position: "fixed", top: 0, left: 0, width: "100%", height: "100%", pointerEvents: "none", zIndex: 0, opacity: 0.04 }}>
        <filter id="noise">
          <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch" />
        </filter>
        <rect width="100%" height="100%" filter="url(#noise)" />
      </svg>
    );

    // ── Network Graph ──────────────────────────────────────────────────
    const NetworkGraph = ({ entries, onNodeClick, activeTags, searchQuery }) => {
      const svgRef = useRef(null);
      const containerRef = useRef(null);
      const [dimensions, setDimensions] = useState({ width: 900, height: 560 });
      const [hoveredNode, setHoveredNode] = useState(null);

      const filtered = useMemo(() => {
        return entries.filter(entry => {
          const matchesSearch = searchQuery === "" ||
            entry.term.toLowerCase().includes(searchQuery.toLowerCase()) ||
            entry.definition.toLowerCase().includes(searchQuery.toLowerCase()) ||
            entry.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase()));
          const matchesTags = activeTags.length === 0 ||
            activeTags.every(tag => entry.tags.includes(tag));
          return matchesSearch && matchesTags;
        });
      }, [entries, activeTags, searchQuery]);

      const graphData = useMemo(() => {
        const termSet = new Set(filtered.map(e => e.term));
        const nodes = filtered.map(e => ({
          id: e.term, tags: e.tags,
          refCount: e.crossRefs.filter(r => termSet.has(r)).length,
          entry: e,
        }));
        const links = [];
        filtered.forEach(entry => {
          entry.crossRefs.forEach(ref => {
            if (termSet.has(ref) && entry.term < ref) {
              links.push({ source: entry.term, target: ref });
            }
          });
        });
        const linkedPairs = new Set(links.map(l => `${l.source}||${l.target}`));
        filtered.forEach((a, i) => {
          filtered.forEach((b, j) => {
            if (i < j) {
              const key1 = a.term < b.term ? `${a.term}||${b.term}` : `${b.term}||${a.term}`;
              if (!linkedPairs.has(key1)) {
                const shared = a.tags.filter(t => b.tags.includes(t));
                if (shared.length >= 2) {
                  links.push({ source: a.term, target: b.term, weak: true, shared: shared.length });
                }
              }
            }
          });
        });
        return { nodes, links };
      }, [filtered]);

      useEffect(() => {
        const obs = new ResizeObserver(([e]) => {
          setDimensions({ width: e.contentRect.width, height: Math.max(400, e.contentRect.height) });
        });
        if (containerRef.current) obs.observe(containerRef.current);
        return () => obs.disconnect();
      }, []);

      useEffect(() => {
        if (!svgRef.current || graphData.nodes.length === 0) return;
        const { width, height } = dimensions;
        const svg = d3.select(svgRef.current);
        svg.selectAll("*").remove();
        const g = svg.append("g");

        const zoom = d3.zoom().scaleExtent([0.3, 4]).on("zoom", (event) => g.attr("transform", event.transform));
        svg.call(zoom);

        const simulation = d3.forceSimulation(graphData.nodes)
          .force("link", d3.forceLink(graphData.links).id(d => d.id).distance(d => d.weak ? 140 : 90).strength(d => d.weak ? 0.05 : 0.3))
          .force("charge", d3.forceManyBody().strength(-220))
          .force("center", d3.forceCenter(width / 2, height / 2))
          .force("collision", d3.forceCollide().radius(35));

        const link = g.append("g").selectAll("line").data(graphData.links).join("line")
          .attr("stroke", d => d.weak ? "rgba(255,255,255,0.04)" : "rgba(255,255,255,0.12)")
          .attr("stroke-width", d => d.weak ? 0.5 : 1)
          .attr("stroke-dasharray", d => d.weak ? "2,4" : "none");

        const node = g.append("g").selectAll("g").data(graphData.nodes).join("g")
          .style("cursor", "pointer")
          .call(d3.drag()
            .on("start", (event, d) => { if (!event.active) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
            .on("drag", (event, d) => { d.fx = event.x; d.fy = event.y; })
            .on("end", (event, d) => { if (!event.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; })
          );

        node.append("circle").attr("r", d => 4 + d.refCount * 2.5)
          .attr("fill", "rgba(255,255,255,0.08)").attr("stroke", "rgba(255,255,255,0.35)").attr("stroke-width", 1);
        node.append("text").text(d => d.id)
          .attr("dx", d => 8 + d.refCount * 2).attr("dy", "0.35em")
          .attr("fill", "rgba(255,255,255,0.55)")
          .attr("font-family", "'Open Sans', sans-serif").attr("font-size", d => `${11 + d.refCount}px`).attr("font-weight", 600);

        node.on("mouseenter", function(event, d) {
          setHoveredNode(d.id);
          const connected = new Set();
          graphData.links.forEach(l => {
            const s = typeof l.source === "object" ? l.source.id : l.source;
            const t = typeof l.target === "object" ? l.target.id : l.target;
            if (s === d.id) connected.add(t);
            if (t === d.id) connected.add(s);
          });
          connected.add(d.id);
          node.select("circle")
            .attr("stroke", n => connected.has(n.id) ? "rgba(255,255,255,0.8)" : "rgba(255,255,255,0.08)")
            .attr("fill", n => n.id === d.id ? "rgba(255,255,255,0.2)" : connected.has(n.id) ? "rgba(255,255,255,0.1)" : "rgba(255,255,255,0.02)");
          node.select("text").attr("fill", n => connected.has(n.id) ? "rgba(255,255,255,0.9)" : "rgba(255,255,255,0.12)");
          link.attr("stroke", l => {
            const s = typeof l.source === "object" ? l.source.id : l.source;
            const t = typeof l.target === "object" ? l.target.id : l.target;
            return (s === d.id || t === d.id) ? "rgba(255,255,255,0.35)" : "rgba(255,255,255,0.02)";
          }).attr("stroke-width", l => {
            const s = typeof l.source === "object" ? l.source.id : l.source;
            const t = typeof l.target === "object" ? l.target.id : l.target;
            return (s === d.id || t === d.id) ? 1.5 : 0.5;
          });
        })
        .on("mouseleave", function() {
          setHoveredNode(null);
          node.select("circle").attr("stroke", "rgba(255,255,255,0.35)").attr("fill", "rgba(255,255,255,0.08)");
          node.select("text").attr("fill", "rgba(255,255,255,0.55)");
          link.attr("stroke", d => d.weak ? "rgba(255,255,255,0.04)" : "rgba(255,255,255,0.12)")
            .attr("stroke-width", d => d.weak ? 0.5 : 1);
        })
        .on("click", (event, d) => onNodeClick(d.entry));

        simulation.on("tick", () => {
          link.attr("x1", d => d.source.x).attr("y1", d => d.source.y).attr("x2", d => d.target.x).attr("y2", d => d.target.y);
          node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        return () => simulation.stop();
      }, [graphData, dimensions, onNodeClick]);

      if (entries.length === 0 || filtered.length === 0) {
        return (
          <div ref={containerRef} style={{ width: "100%", height: "450px", display: "flex", alignItems: "center", justifyContent: "center", border: "1px solid rgba(255,255,255,0.04)" }}>
            <div style={{ textAlign: "center" }}>
              <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "15px", color: "rgba(255,255,255,0.2)", fontStyle: "italic", marginBottom: "8px" }}>
                {entries.length === 0 ? "No entries yet." : "No entries match your current filters."}
              </p>
              {entries.length === 0 && <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.12)", letterSpacing: "0.1em" }}>Submit the first entry to begin building the network.</p>}
            </div>
          </div>
        );
      }

      return (
        <div ref={containerRef} style={{ width: "100%", height: "560px", position: "relative" }}>
          <svg ref={svgRef} width={dimensions.width} height={dimensions.height} style={{ width: "100%", height: "100%", background: "transparent" }} />
          {hoveredNode && (
            <div style={{ position: "absolute", bottom: "12px", left: "12px", fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.1em", color: "rgba(255,255,255,0.3)", textTransform: "uppercase" }}>
              Click node to expand · Drag to rearrange · Scroll to zoom
            </div>
          )}
        </div>
      );
    };

    // ── Entry Card ─────────────────────────────────────────────────────
    const EntryCard = ({ entry, onTagClick, onTermClick, isExpanded, onToggle }) => {
      const [hovered, setHovered] = useState(false);
      return (
        <div onClick={onToggle} onMouseEnter={() => setHovered(true)} onMouseLeave={() => setHovered(false)}
          style={{ borderBottom: "1px solid rgba(255,255,255,0.08)", padding: isExpanded ? "28px 0" : "18px 0", cursor: "pointer", transition: "all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)" }}>
          <div style={{ display: "flex", alignItems: "baseline", gap: "16px", marginBottom: isExpanded ? "16px" : "0" }}>
            <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: isExpanded ? "28px" : "20px", fontWeight: 700, color: hovered || isExpanded ? "#ffffff" : "rgba(255,255,255,0.78)", letterSpacing: "0.02em", transition: "all 0.4s ease", lineHeight: 1.2 }}>{entry.term}</span>
            <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.18)", letterSpacing: "0.15em", textTransform: "uppercase" }}>{entry.tags.length} tags · {entry.crossRefs.length} refs</span>
            <div style={{ flex: 1 }} />
            <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.18)", transform: isExpanded ? "rotate(90deg)" : "rotate(0deg)", transition: "transform 0.3s ease", flexShrink: 0 }}>→</span>
          </div>
          <div style={{ maxHeight: isExpanded ? "1200px" : "0", overflow: "hidden", transition: "max-height 0.6s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.4s ease", opacity: isExpanded ? 1 : 0 }}>
            <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "15px", lineHeight: 1.75, color: "rgba(255,255,255,0.65)", marginBottom: "20px", maxWidth: "720px" }}>{entry.definition}</p>

            {/* Image if present */}
            {entry.imageUrl && (
              <div style={{ marginBottom: "16px" }}>
                <img src={entry.imageUrl} alt={entry.term} style={{ maxWidth: "100%", maxHeight: "300px", objectFit: "contain", opacity: 0.85, border: "1px solid rgba(255,255,255,0.06)" }} />
              </div>
            )}

            <div style={{ display: "flex", flexWrap: "wrap", gap: "6px", marginBottom: "16px" }}>
              {entry.tags.map(tag => (
                <span key={tag} onClick={(e) => { e.stopPropagation(); onTagClick(tag); }}
                  style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", padding: "4px 10px", border: "1px solid rgba(255,255,255,0.14)", color: "rgba(255,255,255,0.55)", letterSpacing: "0.1em", textTransform: "uppercase", cursor: "pointer", transition: "all 0.2s ease", background: "rgba(255,255,255,0.02)" }}
                  onMouseEnter={e => { e.target.style.background = "rgba(255,255,255,0.1)"; e.target.style.borderColor = "rgba(255,255,255,0.4)"; e.target.style.color = "#fff"; }}
                  onMouseLeave={e => { e.target.style.background = "rgba(255,255,255,0.02)"; e.target.style.borderColor = "rgba(255,255,255,0.14)"; e.target.style.color = "rgba(255,255,255,0.55)"; }}
                >{tag}</span>
              ))}
            </div>
            {entry.crossRefs.length > 0 && (
              <div style={{ marginBottom: "16px" }}>
                <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", color: "rgba(255,255,255,0.22)", letterSpacing: "0.2em", textTransform: "uppercase", marginRight: "10px" }}>See also</span>
                {entry.crossRefs.map((ref, i) => (
                  <span key={ref}>
                    <span onClick={(e) => { e.stopPropagation(); onTermClick(ref); }}
                      style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "13px", color: "rgba(255,255,255,0.45)", cursor: "pointer", borderBottom: "1px solid rgba(255,255,255,0.18)", transition: "all 0.2s ease" }}
                      onMouseEnter={e => { e.target.style.color = "#fff"; e.target.style.borderBottomColor = "#fff"; }}
                      onMouseLeave={e => { e.target.style.color = "rgba(255,255,255,0.45)"; e.target.style.borderBottomColor = "rgba(255,255,255,0.18)"; }}
                    >{ref}</span>
                    {i < entry.crossRefs.length - 1 && <span style={{ color: "rgba(255,255,255,0.12)", margin: "0 8px", fontSize: "10px" }}>·</span>}
                  </span>
                ))}
              </div>
            )}
            {entry.citations.length > 0 && (
              <div style={{ marginBottom: "16px", paddingLeft: "16px", borderLeft: "2px solid rgba(255,255,255,0.06)" }}>
                {entry.citations.map((cite, i) => (
                  <p key={i} style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "12px", lineHeight: 1.6, color: "rgba(255,255,255,0.28)", fontStyle: "italic", marginBottom: i < entry.citations.length - 1 ? "6px" : "0" }}>{cite}</p>
                ))}
              </div>
            )}

            {/* Media link if present */}
            {entry.mediaUrl && (
              <div style={{ marginBottom: "16px" }}>
                <a href={entry.mediaUrl} target="_blank" rel="noopener noreferrer"
                  style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.35)", letterSpacing: "0.1em", textTransform: "uppercase", borderBottom: "1px solid rgba(255,255,255,0.15)" }}>
                  ↗ View media
                </a>
              </div>
            )}

            <div style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", color: "rgba(255,255,255,0.16)", letterSpacing: "0.15em", textTransform: "uppercase" }}>
              {entry.author} · {entry.date}
            </div>
          </div>
        </div>
      );
    };

    // ── Main App ───────────────────────────────────────────────────────
    function App() {
      const { entries, loading, error } = useFetchEntries();
      const [searchQuery, setSearchQuery] = useState("");
      const [activeTags, setActiveTags] = useState([]);
      const [expandedId, setExpandedId] = useState(null);
      const [viewMode, setViewMode] = useState("list");
      const [sortMode, setSortMode] = useState("alpha");
      const [showInfo, setShowInfo] = useState(false);
      const [networkDetail, setNetworkDetail] = useState(null);
      const [loaded, setLoaded] = useState(false);
      const inputRef = useRef(null);

      useEffect(() => { setTimeout(() => setLoaded(true), 100); }, []);

      const allTags = useMemo(() => ALL_TAGS_FROM(entries), [entries]);

      const toggleTag = (tag) => {
        setActiveTags(prev => prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]);
      };

      const navigateToTerm = (termName) => {
        const entry = entries.find(e => e.term === termName);
        if (entry) { setExpandedId(entry.id); setSearchQuery(""); setActiveTags([]); setViewMode("list"); }
      };

      const handleNetworkNodeClick = useCallback((entry) => {
        setNetworkDetail(prev => prev && prev.id === entry.id ? null : entry);
      }, []);

      const filteredEntries = useMemo(() => {
        const filtered = entries.filter(entry => {
          const matchesSearch = searchQuery === "" ||
            entry.term.toLowerCase().includes(searchQuery.toLowerCase()) ||
            entry.definition.toLowerCase().includes(searchQuery.toLowerCase()) ||
            entry.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase()));
          const matchesTags = activeTags.length === 0 || activeTags.every(tag => entry.tags.includes(tag));
          return matchesSearch && matchesTags;
        });
        if (sortMode === "alpha") return filtered.sort((a, b) => a.term.localeCompare(b.term));
        if (sortMode === "chrono") return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
        if (sortMode === "tags") return filtered.sort((a, b) => b.tags.length - a.tags.length);
        return filtered;
      }, [entries, searchQuery, activeTags, sortMode]);

      const entryCount = filteredEntries.length;
      const totalCount = entries.length;

      const monoBtn = (label, isActive, onClick) => (
        <button onClick={onClick} style={{
          fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.12em",
          textTransform: "uppercase", padding: "4px 10px",
          background: isActive ? "rgba(255,255,255,0.08)" : "transparent",
          border: `1px solid ${isActive ? "rgba(255,255,255,0.3)" : "rgba(255,255,255,0.07)"}`,
          color: isActive ? "#fff" : "rgba(255,255,255,0.3)", cursor: "pointer", transition: "all 0.2s ease",
        }}>{label}</button>
      );

      const notConfigured = GOOGLE_SHEET_CSV_URL === "YOUR_PUBLISHED_CSV_URL_HERE";

      return (
        <div style={{ minHeight: "100vh", background: "#000000", color: "#ffffff", position: "relative", overflow: "hidden" }}>
          <NoiseSVG />
          <div style={{
            position: "relative", zIndex: 1, maxWidth: "960px", margin: "0 auto", padding: "60px 32px",
            opacity: loaded ? 1 : 0, transform: loaded ? "translateY(0)" : "translateY(20px)",
            transition: "all 0.8s cubic-bezier(0.25, 0.1, 0.25, 1)",
          }}>

            {/* Header */}
            <header style={{ marginBottom: "60px" }}>
              <div style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.3em", textTransform: "uppercase", color: "rgba(255,255,255,0.22)", marginBottom: "24px", display: "flex", justifyContent: "space-between" }}>
                <span>Harvard GSD · MDes Open Project · Spring 2026</span>
                <span>{totalCount} {totalCount === 1 ? "entry" : "entries"}</span>
              </div>

              <h1 style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "clamp(36px, 6vw, 64px)", fontWeight: 800, lineHeight: 1.0, color: "#ffffff", marginBottom: "8px", letterSpacing: "-0.02em" }}>Energy Dreams</h1>
              <h2 style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "clamp(18px, 3vw, 28px)", fontWeight: 300, fontStyle: "italic", color: "rgba(255,255,255,0.3)", marginBottom: "24px" }}>A Collaborative Lexicon</h2>

              <div style={{ height: "1px", background: "linear-gradient(90deg, rgba(255,255,255,0.5), rgba(255,255,255,0.0))", marginBottom: "24px", animation: "lineExpand 1.2s cubic-bezier(0.25, 0.1, 0.25, 1) forwards" }} />

              <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "14px", lineHeight: 1.8, color: "rgba(255,255,255,0.38)", maxWidth: "640px" }}>
                A collaborative glossary of critical terms, concepts, and frameworks for navigating the entangled landscapes of energy, extractive geographies, ecology, and the planetary crisis.
              </p>

              <div style={{ display: "flex", gap: "12px", marginTop: "20px", flexWrap: "wrap" }}>
                <button onClick={() => setShowInfo(!showInfo)} style={{
                  fontFamily: "'Open Sans', sans-serif", fontSize: "10px", letterSpacing: "0.15em",
                  textTransform: "uppercase", padding: "8px 16px", background: "transparent",
                  border: "1px solid rgba(255,255,255,0.1)", color: "rgba(255,255,255,0.5)", cursor: "pointer", transition: "all 0.2s ease",
                }}
                  onMouseEnter={e => { e.target.style.background = "rgba(255,255,255,0.05)"; e.target.style.color = "#fff"; }}
                  onMouseLeave={e => { e.target.style.background = "transparent"; e.target.style.color = "rgba(255,255,255,0.5)"; }}
                >{showInfo ? "Close" : "About"}</button>

                <a href={notConfigured ? "#" : GOOGLE_FORM_URL} target={notConfigured ? "_self" : "_blank"} rel="noopener noreferrer" style={{
                  fontFamily: "'Open Sans', sans-serif", fontSize: "10px", letterSpacing: "0.15em",
                  textTransform: "uppercase", padding: "8px 16px", background: "rgba(255,255,255,0.07)",
                  border: "1px solid rgba(255,255,255,0.18)", color: "#ffffff", cursor: "pointer",
                  textDecoration: "none", display: "inline-block", transition: "all 0.2s ease",
                }}
                  onMouseEnter={e => { e.target.style.background = "rgba(255,255,255,0.14)"; }}
                  onMouseLeave={e => { e.target.style.background = "rgba(255,255,255,0.07)"; }}
                >+ Submit Entry</a>
              </div>

              {showInfo && (
                <div style={{ marginTop: "24px", padding: "24px", background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.06)", animation: "fadeInUp 0.4s ease forwards" }}>
                  <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "14px", lineHeight: 1.8, color: "rgba(255,255,255,0.45)" }}>
                    This glossary is part of <em>Energy Dreams*</em>, an MDes Open Project at the Harvard Graduate School of Design (Spring 2026), instructed by Rosalea Monacella. It operates as a collectively authored map of the conceptual terrain through which the course moves. Each term is a node in a larger network of ideas connecting energy, landscape, extraction, the planetary, and design.
                  </p>
                  <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "11px", lineHeight: 1.6, color: "rgba(255,255,255,0.28)", fontStyle: "italic", marginTop: "14px" }}>
                    * Michael Marder, <em>Energy Dreams: Of Actuality</em> (New York: Columbia University Press, 2017).
                  </p>
                </div>
              )}

              {/* Config warning */}
              {notConfigured && (
                <div style={{ marginTop: "24px", padding: "20px", background: "rgba(255,255,255,0.03)", border: "1px solid rgba(255,255,255,0.08)", animation: "fadeInUp 0.4s ease forwards" }}>
                  <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "12px", color: "rgba(255,255,255,0.5)", lineHeight: 1.7 }}>
                    <strong style={{ color: "rgba(255,255,255,0.8)" }}>Setup required:</strong> Open <code style={{ background: "rgba(255,255,255,0.06)", padding: "2px 6px", fontSize: "11px" }}>index.html</code> and replace <code style={{ background: "rgba(255,255,255,0.06)", padding: "2px 6px", fontSize: "11px" }}>YOUR_PUBLISHED_CSV_URL_HERE</code> and <code style={{ background: "rgba(255,255,255,0.06)", padding: "2px 6px", fontSize: "11px" }}>YOUR_GOOGLE_FORM_URL_HERE</code> with your actual URLs. See the setup guide for details.
                  </p>
                </div>
              )}
            </header>

            {/* Loading state */}
            {loading && (
              <div style={{ padding: "60px 0", textAlign: "center" }}>
                <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "13px", color: "rgba(255,255,255,0.3)", letterSpacing: "0.1em" }}>Loading glossary…</p>
              </div>
            )}

            {/* Error state */}
            {error && (
              <div style={{ padding: "40px 0", textAlign: "center" }}>
                <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "13px", color: "rgba(255,100,100,0.6)" }}>Error loading entries: {error}</p>
              </div>
            )}

            {/* Search + Controls */}
            {!loading && (
              <div style={{ marginBottom: "32px" }}>
                <div style={{ position: "relative", marginBottom: "20px" }}>
                  <input ref={inputRef} type="text" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} placeholder="Search terms, definitions, tags…" style={{
                    width: "100%", fontFamily: "'Open Sans', sans-serif", fontSize: "16px",
                    padding: "14px 0", background: "transparent", border: "none",
                    borderBottom: "1px solid rgba(255,255,255,0.1)", color: "#ffffff", outline: "none", transition: "border-color 0.3s ease",
                  }}
                    onFocus={e => e.target.style.borderBottomColor = "rgba(255,255,255,0.4)"}
                    onBlur={e => e.target.style.borderBottomColor = "rgba(255,255,255,0.1)"}
                  />
                  {searchQuery && <span onClick={() => setSearchQuery("")} style={{ position: "absolute", right: "0", top: "50%", transform: "translateY(-50%)", fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.25)", cursor: "pointer", letterSpacing: "0.1em" }}>CLEAR</span>}
                </div>

                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: "12px", marginBottom: "16px" }}>
                  <div style={{ display: "flex", gap: "4px", alignItems: "center" }}>
                    <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.2em", textTransform: "uppercase", color: "rgba(255,255,255,0.18)", marginRight: "6px" }}>View</span>
                    {monoBtn("List", viewMode === "list", () => { setViewMode("list"); setNetworkDetail(null); })}
                    {monoBtn("Network", viewMode === "network", () => setViewMode("network"))}
                  </div>
                  {viewMode === "list" && (
                    <div style={{ display: "flex", gap: "4px", alignItems: "center" }}>
                      <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.2em", textTransform: "uppercase", color: "rgba(255,255,255,0.18)", marginRight: "6px" }}>Sort</span>
                      {monoBtn("A → Z", sortMode === "alpha", () => setSortMode("alpha"))}
                      {monoBtn("Recent", sortMode === "chrono", () => setSortMode("chrono"))}
                      {monoBtn("Tags", sortMode === "tags", () => setSortMode("tags"))}
                    </div>
                  )}
                </div>

                {allTags.length > 0 && (
                  <div style={{ display: "flex", flexWrap: "wrap", gap: "6px", alignItems: "center" }}>
                    <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.2em", textTransform: "uppercase", color: "rgba(255,255,255,0.18)", marginRight: "8px" }}>Filter</span>
                    {allTags.map(tag => {
                      const isActive = activeTags.includes(tag);
                      return <span key={tag} onClick={() => toggleTag(tag)} style={{
                        fontFamily: "'Open Sans', sans-serif", fontSize: "9px", padding: "3px 8px",
                        border: `1px solid ${isActive ? "rgba(255,255,255,0.45)" : "rgba(255,255,255,0.07)"}`,
                        color: isActive ? "#ffffff" : "rgba(255,255,255,0.25)",
                        background: isActive ? "rgba(255,255,255,0.07)" : "transparent",
                        letterSpacing: "0.08em", textTransform: "uppercase", cursor: "pointer", transition: "all 0.2s ease",
                      }}>{tag}</span>
                    })}
                    {activeTags.length > 0 && <span onClick={() => setActiveTags([])} style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", color: "rgba(255,255,255,0.2)", cursor: "pointer", marginLeft: "8px", letterSpacing: "0.1em" }}>✕ Clear</span>}
                  </div>
                )}

                <div style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.15em", textTransform: "uppercase", color: "rgba(255,255,255,0.12)", marginTop: "16px" }}>
                  {totalCount === 0 ? "No entries yet" : `Showing ${entryCount} of ${totalCount} ${totalCount === 1 ? "entry" : "entries"}`}
                </div>
              </div>
            )}

            {/* Content */}
            {!loading && viewMode === "network" ? (
              <div>
                <NetworkGraph entries={entries} onNodeClick={handleNetworkNodeClick} activeTags={activeTags} searchQuery={searchQuery} />
                {networkDetail && (
                  <div style={{ marginTop: "24px", padding: "28px", background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.08)", animation: "fadeInUp 0.3s ease forwards" }}>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "baseline", marginBottom: "16px" }}>
                      <h3 style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "24px", fontWeight: 700, color: "#fff" }}>{networkDetail.term}</h3>
                      <span onClick={() => setNetworkDetail(null)} style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.3)", cursor: "pointer", letterSpacing: "0.1em" }}>✕ CLOSE</span>
                    </div>
                    <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "15px", lineHeight: 1.75, color: "rgba(255,255,255,0.65)", marginBottom: "16px", maxWidth: "720px" }}>{networkDetail.definition}</p>
                    <div style={{ display: "flex", flexWrap: "wrap", gap: "6px", marginBottom: "12px" }}>
                      {networkDetail.tags.map(tag => <span key={tag} style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", padding: "4px 10px", border: "1px solid rgba(255,255,255,0.14)", color: "rgba(255,255,255,0.55)", letterSpacing: "0.1em", textTransform: "uppercase" }}>{tag}</span>)}
                    </div>
                    {networkDetail.crossRefs.length > 0 && (
                      <div style={{ marginBottom: "12px" }}>
                        <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", color: "rgba(255,255,255,0.22)", letterSpacing: "0.2em", textTransform: "uppercase", marginRight: "10px" }}>See also</span>
                        {networkDetail.crossRefs.map((ref, i) => (
                          <span key={ref}>
                            <span onClick={() => { const e = entries.find(x => x.term === ref); if (e) setNetworkDetail(e); }} style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "13px", color: "rgba(255,255,255,0.45)", cursor: "pointer", borderBottom: "1px solid rgba(255,255,255,0.18)" }}>{ref}</span>
                            {i < networkDetail.crossRefs.length - 1 && <span style={{ color: "rgba(255,255,255,0.12)", margin: "0 8px" }}>·</span>}
                          </span>
                        ))}
                      </div>
                    )}
                    {networkDetail.citations.length > 0 && (
                      <div style={{ paddingLeft: "16px", borderLeft: "2px solid rgba(255,255,255,0.06)", marginBottom: "12px" }}>
                        {networkDetail.citations.map((c, i) => <p key={i} style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "12px", lineHeight: 1.6, color: "rgba(255,255,255,0.28)", fontStyle: "italic", marginBottom: i < networkDetail.citations.length - 1 ? "6px" : "0" }}>{c}</p>)}
                      </div>
                    )}
                    <div style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", color: "rgba(255,255,255,0.16)", letterSpacing: "0.15em", textTransform: "uppercase" }}>{networkDetail.author} · {networkDetail.date}</div>
                  </div>
                )}
              </div>
            ) : !loading && (
              <div style={{ borderTop: "1px solid rgba(255,255,255,0.08)" }}>
                {entries.length === 0 ? (
                  <div style={{ padding: "80px 0", textAlign: "center" }}>
                    <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "16px", color: "rgba(255,255,255,0.22)", fontStyle: "italic", marginBottom: "12px" }}>This lexicon is waiting for its first entry.</p>
                    <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "10px", color: "rgba(255,255,255,0.12)", letterSpacing: "0.12em" }}>Use the Submit Entry button above to contribute.</p>
                  </div>
                ) : filteredEntries.length === 0 ? (
                  <div style={{ padding: "60px 0", textAlign: "center" }}>
                    <p style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "15px", color: "rgba(255,255,255,0.2)", fontStyle: "italic" }}>No entries match your search.</p>
                  </div>
                ) : filteredEntries.map((entry, i) => (
                  <div key={entry.id} style={{ animation: `fadeInUp 0.4s ease ${i * 0.05}s forwards`, opacity: 0 }}>
                    <EntryCard entry={entry} onTagClick={toggleTag} onTermClick={navigateToTerm} isExpanded={expandedId === entry.id} onToggle={() => setExpandedId(expandedId === entry.id ? null : entry.id)} />
                  </div>
                ))}
              </div>
            )}

            {/* Footer */}
            <footer style={{ marginTop: "80px", paddingTop: "24px", borderTop: "1px solid rgba(255,255,255,0.04)", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
              <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.2em", textTransform: "uppercase", color: "rgba(255,255,255,0.12)" }}>Energy Dreams · Harvard GSD · 2026</span>
              <span style={{ fontFamily: "'Open Sans', sans-serif", fontSize: "9px", letterSpacing: "0.15em", color: "rgba(255,255,255,0.12)", animation: "pulse 3s ease infinite" }}>● Live</span>
            </footer>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
